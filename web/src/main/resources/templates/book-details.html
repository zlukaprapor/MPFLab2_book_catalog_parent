<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title th:text="${book.title}">–î–µ—Ç–∞–ª—ñ –∫–Ω–∏–≥–∏</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<div class="container">
    <a th:href="@{/books}" class="back-link" th:text="#{button.back}">‚Üê –ù–∞–∑–∞–¥</a>

    <div class="book-detail">
        <h1 th:text="${book.title}">–ù–∞–∑–≤–∞ –∫–Ω–∏–≥–∏</h1>
        <div class="book-author" th:text="|‚úçÔ∏è ${book.author}|">–ê–≤—Ç–æ—Ä</div>
        <div class="book-meta">
            <span th:if="${book.isbn}" th:text="|üìñ ISBN: ${book.isbn}|">ISBN</span>
            <span th:if="${book.year}" th:text="|üìÖ –†—ñ–∫: ${book.year}|">–†—ñ–∫</span>
        </div>
    </div>

    <div class="comments-section">
        <h2 th:text="#{section.comments.title}">üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</h2>

        <!-- –§–æ—Ä–º–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è - —Ç—ñ–ª—å–∫–∏ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö USER —ñ ADMIN -->
        <div sec:authorize="isAuthenticated()">
            <form th:action="@{/books/{id}/comments(id=${book.id})}" method="post" class="comment-form">
                <div class="form-group">
                    <label for="author" th:text="#{form.comment.author}">–í–∞—à–µ —ñ–º'—è:</label>
                    <input type="text"
                           id="author"
                           name="author"
                           th:value="${#authentication.name}"
                           readonly
                           required>
                </div>
                <div class="form-group">
                    <label for="text" th:text="#{form.comment.text}">–ö–æ–º–µ–Ω—Ç–∞—Ä:</label>
                    <textarea id="text" name="text" required></textarea>
                </div>
                <button type="submit" th:text="#{button.add.comment}">üí¨ –î–æ–¥–∞—Ç–∏</button>
            </form>
        </div>

        <div sec:authorize="!isAuthenticated()" style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px; margin-bottom: 20px;">
            <p style="color: #666;">
                –©–æ–± –∑–∞–ª–∏—à–∏—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä, –±—É–¥—å –ª–∞—Å–∫–∞,
                <a th:href="@{/login}" style="color: #667eea; text-decoration: none; font-weight: 600;">—É–≤—ñ–π–¥—ñ—Ç—å</a>
                –∞–±–æ
                <a th:href="@{/register}" style="color: #667eea; text-decoration: none; font-weight: 600;">–∑–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ—Å—å</a>
            </p>
        </div>

        <div th:if="${comments.isEmpty()}" class="no-comments">
            <p th:text="#{message.no.comments}">–©–µ –Ω–µ–º–∞—î –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤</p>
        </div>

        <div th:unless="${comments.isEmpty()}">
            <div th:each="comment : ${comments}" class="comment">
                <div class="comment-header">
                    <span class="comment-author">
                        <a th:href="@{/users/{id}/comments(id=${comment.id})}"
                           style="color: #667eea; text-decoration: none; font-weight: 600;"
                           th:text="${comment.author}">
                            –ê–≤—Ç–æ—Ä
                        </a>
                    </span>
                    <span class="comment-date"
                          th:text="${#temporals.format(comment.createdAt, 'dd.MM.yyyy HH:mm')}">
                        –î–∞—Ç–∞
                    </span>
                </div>
                <p th:text="${comment.text}">–¢–µ–∫—Å—Ç</p>

                <!-- –ö–Ω–æ–ø–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è - —Ç—ñ–ª—å–∫–∏ –¥–ª—è ADMIN -->
                <form sec:authorize="hasRole('ADMIN')"
                      th:action="@{/books/{bookId}/comments/{commentId}/delete(bookId=${book.id}, commentId=${comment.id})}"
                      method="post"
                      style="display:inline;">
                    <button type="submit" class="btn-delete" th:text="#{button.delete}">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>
                </form>
            </div>
        </div>
    </div>
</div>
</body>
</html>